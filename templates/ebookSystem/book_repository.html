{% extends "base_nav.html" %}
{% load staticfiles %}
{% block title %}
平台書庫
{% endblock %}
{% block header %}
平台書庫
{% endblock %}
{% block content %}
<h3>平台書庫</h3>

<script id="tmp_booklist_tabframe" type="text/x-custom-template">
	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th>ISBN</th>
				<th>書名</th>
				<th>裝訂冊數</th>
				<th>版次</th>
				<th>作者</th>
				<th>出版社</th>
				<th>出版日期</th>
			</tr>
		</thead>
		<tbody id="tbody_booklist">
		</tbody>
	</table>
</script>
<script id="tmp_booklist_row" type="text/x-jquery-tmpl">
	<tr>
		<td>${ISBN}</td>
		<td>${bookname}</td>
		<td>${bookbinding}</td>
		<td>${order}</td>
		<td>${author}</td>
		<td>${house}</td>
		<td>${date}</td>
		<td>${action}</td>
	</tr>
</script>

<div id="qwe">
</div>

<script>


	_.delay(function(){

		$('[name="repository_booklist_tab_grp"]').eq(0).click();

		$('#search_value').val('9789866104626')
				
	},100)


	function search(){

		//search_type
		let search_type=$('[name="search_type"]:checked').val();

		//search_value
		let search_value=$('#search_value').val();

		//url
		let url='/ebookSystem/book_list';

		//transferData
		let transferData={
			'query_type':search_type,
			'query_value':search_value
		};

		//aj_get
		aj_get(url,transferData)
		.done(function(o){
			console.log(o)
			
			// o=[
			// 	[
			// 		{
			// 			"upload_date": "2017-08-24", 
			// 			"finish_date": "None"
			// 		}, 
			// 		{
			// 			"ISBN": "9789573321569", 
			// 			"author": "*5091*4f5b*745e.*8fea*4f5b(Jeffery Deaver)*8457;", 
			// 			"house": "*7687*51a0", 
			// 			"bookname": "*85cd*8272*99ed*5ba2", 
			// 			"bookbinding": "*5e73*88dd", 
			// 			"source": "", 
			// 			"date": "2005- 07-01", 
			// 			"chinese_book_category": "874", 
			// 			"order": "*521d*7248"
			// 		}
			// 	],
			// 	[
			// 		{
			// 			"upload_date": "2017-08-24", 
			// 			"finish_date": "None"
			// 		}, 
			// 		{
			// 			"ISBN": "9789573321569", 
			// 			"author": "a", 
			// 			"house": "b", 
			// 			"bookname": "c", 
			// 			"bookbinding": "d", 
			// 			"source": "", 
			// 			"date": "2005- 07-01", 
			// 			"chinese_book_category": "874", 
			// 			"order": "e"
			// 		}
			// 	],
			// ];

			//p
			let p=[];
			_.each(o, function(v,k){
				p.push(v[1]);
			})

			//tabframe
			$('#repository_booklist_div_查詢').html($('#tmp_booklist_tabframe').html());

			//tmpl
			$('#tmp_booklist_row').tmpl(p).appendTo('#tbody_booklist');

		})
		
	}


</script>	


<ul class="nav nav-tabs">
	<li><a href="#repository_booklist_tab_查詢" name="repository_booklist_tab_grp" data-toggle="tab">查詢</a></li>
	<li><a href="#repository_booklist_tab_索引" name="repository_booklist_tab_grp" data-toggle="tab">索引</a></li>
</ul>


<div class="tab-content" style="padding-top:20px;">

	<div id="repository_booklist_tab_查詢" class="tab-pane">

		<div class="form-inline" style="margin-bottom:20px;">
			<div class="form-group">
				<label style="margin-right:15px;"><input type="radio" name="search_type" value="ISBN" checked="true">ISBN</label>
				<label style="margin-right:15px;"><input type="radio" name="search_type" value="bookname">書名</label>
				<input id="search_value" class="form-control" maxlength="15" type="text">
			</div>
			<button type="submit" class="btn btn-primary" name="search_name" value="search" onclick="search()">搜尋</button>
		</div>

		<div id="repository_booklist_div_查詢"></div>

	</div>

	<div id="repository_booklist_tab_索引" class="tab-pane"></div>

</div>




<ul class="nav nav-tabs">

{% for category, bookinfos in books_list %}

	<li><a href="#booklist_tab_{{ category }}_div" name="booklist_tab_a_name" ics="{{ category }}" data-toggle="tab">圖書分類號：{{ category }}</a></li>

{% endfor %}

</ul>


<div class="tab-content">

	{% for category, bookinfos in books_list %}

	<div class="tab-pane" style="margin-top:30px;" id="booklist_tab_{{ category }}_div">

		{% if bookinfos|length > 0 %}

			<table class="table table-striped table-hover">
				<tr>
					<th>ISBN</th>
					<th>書名</th>
					<th>裝訂冊數</th>
					<th>版次</th>
					<th>作者</th>
					<th>出版社</th>
					<th>出版日期</th>
				</tr>
				{% for bookinfo in bookinfos %}
				<tr>
					<td>{{ bookinfo.ISBN }}</td>
					<td>{{ bookinfo.bookname }}</td>
					<td>{{ bookinfo.bookbinding }}</td>
					<td>{{ bookinfo.order }}</td>
					<td>{{ bookinfo.author }}</td>
					<td>{{ bookinfo.house }}</td>
					<td>{{ bookinfo.date }}</td>
				</tr>
				{% endfor %}
			</table>

		{% else %}

			<div>目前尚無書籍資料</div>

		{% endif %}

	</div>

	{% endfor %}

</div>


<script>

 	$(document).ready(function () {

		var ocs={
			0:'總類',	
			1:'哲學',	
			2:'宗教',
			3:'科學',
			4:'應用科學',
			5:'社會科學',
			6:'史地類',
			7:'世界史地',
			8:'語言文學',
			9:'藝術'
		}

		$('a[name="booklist_tab_a_name"]').each(function(){
			var a=$(this);
			var ics=parseInt(a.attr('ics'));
			var cs=ocs[ics];
			var html=cs+'('+ics+')';
			a.html(html);
		})

		$('a[name="booklist_tab_a_name"]').eq(0).click();

    });
	
</script>


{% endblock %}