{% extends "base_nav.html" %}
{% load staticfiles %}
{% block title %}
平台書庫
{% endblock %}
{% block header %}
平台書庫
{% endblock %}
{% block content %}
{% csrf_token %}

<h3>平台書庫</h3>

<script id="tmp_booklist_tabframe" type="text/x-custom-template">
	<table class="table table-striped table-hover">
		<thead style="background-color:#fafafa; border-top:2px solid #eeeeee;">
			<tr>
				<th style="text-align:center; vertical-align: top; padding:5px;">ISBN</th>
				<th style="text-align:center; vertical-align: top; padding:5px;">書名</th>
				<th style="text-align:center; vertical-align: top; padding:5px;">裝訂冊數</th>
				<th style="text-align:center; vertical-align: top; padding:5px;">版次</th>
				<th style="text-align:center; vertical-align: top; padding:5px;">作者</th>
				<th style="text-align:center; vertical-align: top; padding:5px;">出版社</th>
				<th style="text-align:center; vertical-align: top; padding:5px;">出版日期</th>
				<th style="text-align:center; vertical-align: top; padding:5px;">動作</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</script>

<script id="tmp_booklist_row" type="text/x-jquery-tmpl">
	<tr>
		<td style="vertical-align: top; padding:5px;">${ISBN}</td>
		<td style="vertical-align: top; padding:5px;">${bookname}</td>
		<td style="vertical-align: top; padding:5px;">${bookbinding}</td>
		<td style="vertical-align: top; padding:5px;">${order}</td>
		<td style="vertical-align: top; padding:5px;">${author}</td>
		<td style="vertical-align: top; padding:5px;">${house}</td>
		<td style="vertical-align: top; padding:5px;">${date}</td>
		<td style="vertical-align: top; padding:5px;">
			<button type="button" class="btn btn-default" ISBN="${ISBN}" onclick="downloadbook(this, false, 'email')">寄到信箱</button>
			<button type="button" class="btn btn-default" ISBN="${ISBN}" onclick="downloadbook(this, false, 'download')">下載</button>
		</td>
	</tr>
</script>


<script>


	_.delay(function(){

		//mxdownloadbook
		inicomp('mxdownloadbook');

		//預先顯示第1分頁
		$('[name="repository_books_tab_grp"]').eq(0).click();

		//$('#search_value').val('9789866104626')

		//listcategory
		listcategory();
		
		//預先顯示第1分頁
		$('[name="repository_bookcategory_tab_grp"]').eq(0).click();
	
	},300)


	function search(){

		//search_type
		let search_type=$('[name="search_type"]:checked').val();

		//search_value
		let search_value=$('#search_value').val();

		//tab
		let tab=$('#repository_books_div_查詢');

		//aj_booklist
		aj_booklist(search_type,search_value)
		.done(function(data){

			//tabframe
			tab.html($('#tmp_booklist_tabframe').html());

			//tmpl
			let h=$('#tmp_booklist_row').tmpl(data).html();

			//html
			tab.find('tbody').html(h);

		})
		.fail(function(msg){
			tab.html(msg);
		})
		
	}


	function listcategory(){

		//ocs
		let ocs={
			0:'總類',	
			1:'哲學',	
			2:'宗教',
			3:'科學',
			4:'應用科學',
			5:'社會科學',
			6:'史地類',
			7:'世界史地',
			8:'語言文學',
			9:'藝術'
		}

		//s
		function gs(c,i){
			return {
				'id':'bookcategory_'+i,
				'title':c,
				'name':'repository_bookcategory_tab_grp',
				'prop':'',
			}
		}
		let s=[];
		_.each(ocs,function(v,k){
			s.push(gs(v,k));
		})

		//page
		let hpage=genpage(s);
		$('#repository_books_div_索引').html(hpage);

		//

		//each 0~9
		_.each(_.range(0,10),function(i){

			//tab
			let tab=$('#bookcategory_'+i);

			//aj_booklist
			aj_booklist('chinese_book_category',i)
			.done(function(data){

				//tabframe
				tab.html($('#tmp_booklist_tabframe').html());

				//tmpl
				let h=$('#tmp_booklist_row').tmpl(data).html();

				//html
				tab.find('tbody').html(h);

			})
			.fail(function(msg){
				tab.html(msg);
			})
			
		})

	}
	


</script>	


<ul class="nav nav-tabs">
	<li><a href="#repository_books_tab_查詢" name="repository_books_tab_grp" data-toggle="tab">查詢</a></li>
	<li><a href="#repository_books_tab_索引" name="repository_books_tab_grp" data-toggle="tab">索引</a></li>
</ul>


<div class="tab-content" style="padding-top:20px;">

	<div id="repository_books_tab_查詢" class="tab-pane">

		<div class="form-inline" style="margin-bottom:20px;">
			<div class="form-group">
				<label style="margin-right:15px;"><input type="radio" name="search_type" value="ISBN" checked="true">ISBN</label>
				<label style="margin-right:15px;"><input type="radio" name="search_type" value="bookname">書名</label>
				<input id="search_value" class="form-control" maxlength="15" type="text">
			</div>
			<button type="button" class="btn btn-primary" onclick="search();">搜尋</button>
		</div>

		<div id="repository_books_div_查詢"></div>

	</div>

	<div id="repository_books_tab_索引" class="tab-pane">

		<div id="repository_books_div_索引"></div>

	</div>

</div>


{% endblock %}