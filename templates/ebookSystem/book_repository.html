{% extends "base_nav.html" %}
{% load staticfiles %}
{% block title %}
平台書庫
{% endblock %}
{% block header %}
平台書庫
{% endblock %}
{% block content %}
{% csrf_token %}


<h3>平台書庫</h3>


<script id="tmp_booklist_tabframe" type="text/x-custom-template">
	<table class="table table-striped table-hover" style="margin:10px 0px;">
		<thead style="background-color:#eee; border-top:2px solid #ddd;">
			<tr>
				<th style="text-align:center; vertical-align: top; padding:10px 0px;">ISBN</th>
				<th style="text-align:center; vertical-align: top; padding:10px 0px;">書名</th>
				<th style="text-align:center; vertical-align: top; padding:10px 0px;">裝訂冊數</th>
				<th style="text-align:center; vertical-align: top; padding:10px 0px;">版次</th>
				<th style="text-align:center; vertical-align: top; padding:10px 0px;">作者</th>
				<th style="text-align:center; vertical-align: top; padding:10px 0px;">出版社</th>
				<th style="text-align:center; vertical-align: top; padding:10px 0px;">出版日期</th>
				<th style="text-align:center; vertical-align: top; padding:10px 0px;">動作</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</script>


<script id="tmp_booklist_row" type="text/x-jquery-tmpl">
	<tr>
		<td style="vertical-align: top; padding:5px;">${ISBN}</td>
		<td style="vertical-align: top; padding:5px;">${bookname}</td>
		<td style="vertical-align: top; padding:5px;">${bookbinding}</td>
		<td style="vertical-align: top; padding:5px;">${order}</td>
		<td style="vertical-align: top; padding:5px;">${author}</td>
		<td style="vertical-align: top; padding:5px;">${house}</td>
		<td style="vertical-align: top; padding:5px;">${date}</td>
		<td style="vertical-align: top; padding:5px;">
			<button type="button" class="btn btn-default" ISBN="${ISBN}" onclick="receivebook(this, false, 'email')">寄到信箱</button>
			<button type="button" class="btn btn-default" ISBN="${ISBN}" onclick="receivebook(this, false, 'download')">下載</button>
		</td>
	</tr>
</script>


<script>


	_.delay(function(){

		//預先顯示第1分頁
		$('[name="repository_books_tab_grp"]').eq(0).click();

		//listrecommend
		listrecommend();
		$('[name="repository_bookrecommend_tab_grp"]').eq(0).click(); //預先顯示第1分頁

		//listcategory
		listcategory();
		$('[name="repository_bookcategory_tab_grp"]').eq(0).click(); //預先顯示第1分頁

		//$('#search_value').val('9789866104626')

	},300)


	function search(){

		//search_type
		let search_type=$('[name="search_type"]:checked').val();

		//search_value
		let search_value=$('#search_value').val();

		//div
		let div=$('#repository_books_div_查詢');

		//aj_booklist
		aj_booklist(search_type,search_value)
		.done(function(data){

			//datatable
			bk_datatable(div,data,'tab_result');

			//alertmessage
			alertmessage('success', '查詢成功，共取得 '+data.length+' 筆資料')

		})
		.fail(function(msg){

			//msg
			div.html(msg);

			//alertmessage
			alertmessage('error', msg)


		})
		
	}


	function listrecommend(){

		//ocs
		let ocs={
			0:'新書上架',	
			1:'平台推薦',	
			2:'借閱排行',
		}

		//s
		function gs(c){
			return {
				'id':'bookrecommend_'+c,
				'title':c,
				'name':'repository_bookrecommend_tab_grp',
				'prop':'',
			}
		}
		let s=[];
		_.each(ocs,function(v,k){
			s.push(gs(v,k));
		})

		//page
		let hpage=pagetab_initial(s);
		$('#repository_books_div_書籍推薦').html(hpage);

	}


	function listcategory(){

		//ocs
		let ocs={
			0:'總類',	
			1:'哲學',	
			2:'宗教',
			3:'科學',
			4:'應用科學',
			5:'社會科學',
			6:'史地類',
			7:'世界史地',
			8:'語言文學',
			9:'藝術'
		}

		//s
		function gs(c,i){
			return {
				'id':'bookcategory_'+i,
				'title':c,
				'name':'repository_bookcategory_tab_grp',
				'prop':'',
			}
		}
		let s=[];
		_.each(ocs,function(v,k){
			s.push(gs(v,k));
		})

		//page
		let hpage=pagetab_initial(s);
		$('#repository_books_div_索引').html(hpage);

		//each 0~9
		_.each(_.range(0,10),function(i){

			//div
			let div=$('#bookcategory_'+i);

			//aj_booklist
			aj_booklist('chinese_book_category',i)
			.done(function(data){

				//datatable
				bk_datatable(div,data,'tab_category_'+i);

			})
			.fail(function(msg){
				div.html(msg);
			})
			
		})

	}
	

	function bk_datatable(div,data,tabid){

		//tabframe
		div.html($('#tmp_booklist_tabframe').html());

		//tmpl
		$('#tmp_booklist_row').tmpl(data).appendTo(div.find('tbody'));

		//set tabid
		div.find('table').attr('id',tabid);

		//pagin
		pagin_initial(tabid);

	}


</script>	


<ul class="nav nav-tabs">
	<li><a href="#repository_books_tab_書籍推薦" name="repository_books_tab_grp" data-toggle="tab">書籍推薦</a></li>
	<li><a href="#repository_books_tab_索引" name="repository_books_tab_grp" data-toggle="tab">索引</a></li>
	<li><a href="#repository_books_tab_查詢" name="repository_books_tab_grp" data-toggle="tab">查詢</a></li>
</ul>


<div class="tab-content" style="padding:20px 0px;">

	<div id="repository_books_tab_書籍推薦" class="tab-pane">

		<div id="repository_books_div_書籍推薦"></div>

	</div>

	<div id="repository_books_tab_索引" class="tab-pane">

		<div id="repository_books_div_索引"></div>

	</div>

	<div id="repository_books_tab_查詢" class="tab-pane">

		<div class="form-inline" style="margin-bottom:20px;">
			<div class="form-group">
				<label for="inp_ISBN" style="margin-right:15px;">
					<input id="inp_ISBN" type="radio" name="search_type" value="ISBN" checked="true">
					ISBN
				</label>
				<label for="inp_bookname" style="margin-right:15px;">
					<input id="inp_bookname" type="radio" name="search_type" value="bookname">
					書名
				</label>
				<input id="search_value" class="form-control" type="text" placeholder="輸入欲查詢資訊" maxlength="15">
			</div>
			<button type="button" class="btn btn-primary" onclick="search();">搜尋</button>
		</div>

		<div id="repository_books_div_查詢"></div>

	</div>

</div>


{% endblock %}


