<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script type="text/javascript" src="/static/ebookSystem/js/jquery/jquery-1.12.4.min.js"></script>
    
    <link href="images/readium_favicon.png" rel="shortcut icon"/>
    <link href="images/readium-touch-icon.png" rel="apple-touch-icon"/>

    <link rel="stylesheet" type="text/css" href="css/readium-all.css">

    <script type="text/javascript" src="scripts/readium-js-viewer_all_LITE.js"> </script>

    <script type="text/javascript" src="font-faces/fonts.js"> </script>

	<script type="text/javascript">

        //hash(採時間戳)，全域變數，載入模板也需要
        let chash = '?' + Date.now();

        //使用document.write做靜態加載
        function commoncssjsadd() {

            //ltcss
            let ltcss = [];
            ltcss.push('');

            //ltjs
            let ltjs = [];
            ltjs.push('/static/ebookSystem/js/frontendsystem.js');

            function comadd_css(href) {
                return '<link rel="stylesheet" href="' + href + '"\>';
            }
            function comadd_js(src) {
                return '<script src="' + src + '"\><\/script>';
            }

            let c = '';
            for (let i = 0; i < ltcss.length; i++) {
                c += comadd_css(ltcss[i] + chash);
            }
            for (let i = 0; i < ltjs.length; i++) {
                c += comadd_js(ltjs[i] + chash);
            }

            return c;
        }
        document.write(commoncssjsadd());

	</script>

    <script>

        function removeitembyclass(cs){
            let t = setInterval(function(){ 
                if($('button[class="'+cs+'"]')){
                    $('button[class="'+cs+'"]').remove();
                }
                else{
                    clearInterval(t);
                }
            }, 10);
        }

        $(function(){

            let p=urlparam();
            let epubLibraryPath;
            if(haskey(p,'view')){
                let a=p.view;
                let u=atou(a);
                let root = document.location.origin;
                epubLibraryPath=root+u;
                window.location.replace('index.html?epub='+epubLibraryPath);
            }
            
            var path = (window.location && window.location.pathname) ? window.location.pathname : ''; 

            // extracts path to index.html (or more generally: /PATH/TO/*.[x]html)
            path = path.replace(/(.*)\/.*\.[x]?html$/, "$1");

            // removes trailing slash
            path = path.charAt(path.length-1) == '/'
                    ? path.substr(0, path.length-1)
                    : path;

            var HTTPServerRootFolder =
            window.location ? (
            window.location.protocol
            + "//"
            + window.location.hostname
            + (window.location.port ? (':' + window.location.port) : '')
            + path
            ) : ''
            ;

            var fontsArray = [];
            if (typeof getFontFaces != "undefined") { // defined externally
                fontsArray = getFontFaces(HTTPServerRootFolder + "/font-faces/");
            }

            // MUST BE *SINGLE* CALL TO require.config() FOR ALMOND (SINGLE BUNDLE) TO WORK CORRECTLY!!!
            require.config({
                /* http://requirejs.org/docs/api.html#config-waitSeconds */
                waitSeconds: 0,

                config : {

                    'readium_js_viewer/ModuleConfig' : {

                        'mathJaxUrl': HTTPServerRootFolder + '/scripts/mathjax/MathJax.js',
                        
                        'fonts': fontsArray,

                        'annotationCSSUrl': HTTPServerRootFolder + '/css/annotations.css',

                        'jsLibRoot': HTTPServerRootFolder + '/scripts/zip/',

                        'useSimpleLoader' : false, // cloud reader (strictly-speaking, this config option is false by default, but we prefer to have it explicitly set here).

                        'epubLibraryPath': epubLibraryPath, // defaults to /epub_content/epub_library.json relative to the application's root index.html ... that being said, this is cloud reader LITE (no library view!)

                        'imagePathPrefix': undefined,

                        'canHandleUrl' : false,
                        'canHandleDirectory' : false,

                        'workerUrl': undefined,
                        'epubReadingSystemUrl': undefined
                    }
                }
            });

            //removeitembyclass
            removeitembyclass('btn icon-shareUrl');
            removeitembyclass('btn icon-library');
            removeitembyclass('btn icon-full-screen');

        })

    </script>

</head>

<body>
    <nav id="app-navbar" class="navbar" role="banner" aria-label="{{Strings.i18n_toolbar}}">
    </nav>
    <div id="app-container">
    </div>
</body>

</html>
